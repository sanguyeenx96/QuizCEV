@model IEnumerable<ViewModels.Category.Response.CategoryVm>

@{
    ViewData["Active"] = "pageChuDePhongThi";
    ViewData["ActiveChild"] = "pageDanhSachChuDePhongThi";
}


<table class="table" style="text-align:center; vertical-align:middle">
    <thead>
        <tr>
            <th>
                Tên
            </th>
            <th>
                Ngày tạo
            </th>
            <th>
                Trạng thái
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateCreate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td>
                    <btn class="btn btn-warning btn-sm btnSua" data-id="@item.Id">Đổi tên</btn>
                    <btn class="btn btn-danger btn-sm btnXoa" data-name="@item.Name">Xoá</btn>
                </td>
            </tr>
        }
    </tbody>
</table>


<script>
    $(document).ready(function () {
        const swalWithBootstrapButtons = Swal.mixin({
            buttonsStyling: true,
        });

        $(".btnSua").click(function (e) {
            var id = $(this).data("id");
            var data = {
                id: id
            };
            $.ajax({
                url: "GetById",
                type: "POST",
                data: data,
                success: function (data) {
                    if (data.success) {
                        handleSuccess(data);
                    } else {
                        Swal.fire("Thất bại!", data.message, "error");
                    }
                },
                error: function (xhr, t, error) {
                    Swal.fire("Thất bại!", "Lỗi máy chủ", "error");
                },
            });
        });

        async function handleSuccess(data) {
            if (data.success) {
                const { value: newName } = await swalWithBootstrapButtons.fire({
                    title: "Đổi tên chủ đề & phòng thi",
                    input: "text",
                    inputLabel: data.data.name,
                    inputPlaceholder: "Nhập tên mới",
                    showCancelButton: true,
                    confirmButtonText: "Xác nhận",
                    cancelButtonText: "Huỷ bỏ"
                });
                if (newName) {
                    Swal.fire(`Entered email: ${newName}`);
                }
            } else {
                Swal.fire("Thất bại!", data.message, "error");
            }
        }

        $(".btnXoa").click(function (e) {
            var name = $(this).data("name");

            swalWithBootstrapButtons
                .fire({
                    title: "Xoá chủ đề & phòng thi?",
                    text: name,
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Xác nhận",
                    cancelButtonText: "Huỷ bỏ"
                })
                .then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: "/Dathang/Delete",
                            type: "POST",
                            data: {
                                id: id,
                                tenlinhkien: tenlinhkien,
                                tenmodel: tenmodel
                            },
                            success: function (data) {
                                if (data.success) {
                                    Swal.fire(
                                        "Thành công!",
                                        "Đơn đặt hàng đã được xoá",
                                        "success"
                                    ).then(function () {
                                        window.location.reload();
                                    });
                                } else {
                                    Swal.fire(
                                        "Không thành công!",
                                        data.message,
                                        "error"
                                    );
                                }
                            },
                        });
                    }
                });

        });
    });
</script>




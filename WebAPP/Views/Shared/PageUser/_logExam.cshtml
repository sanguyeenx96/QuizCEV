@model ViewModels.ExamResult.Response.ExamResultVm
@{
    float totalScore = Model.Score;
    string danhgia = (totalScore >= 8) ? "tốt" : (totalScore >= 6) ? "trung bình" : "không đạt";
    int demtn = 0;
    int demtl = 0;
    float scoreTN = ViewBag.scoreTN;
    float totalScoreTN = ViewBag.totalScoreTN;
    float scoreTL = ViewBag.scoreTL;
    float totalScoreTL = ViewBag.totalScoreTL;
    int slDungTN = ViewBag.slDungTN;
    int slCauhoiTN = ViewBag.slCauhoiTN;
    int slDungTL = ViewBag.slDungTL;
    int slCauhoiTL = ViewBag.slCauhoiTL;

}

<div class="modal-content">
    <div class="modal-header">
        <h1 class="modal-title display-6  ">
            <i class="bi-chevron-down"></i>
            Kết quả bài thi @Model.CategoryName
        </h1>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-md-12">
                <div class="card mb-3
                     @{
                     if (danhgia == "tốt")
                     {
                                        <text>border-top-success border-top-3 mb-3</text>
            }
            if (danhgia == "trung bình")
            {
                                        <text>border-top-warning border-top-3 mb-3</text>
            }
            if (danhgia == "không đạt")
            {
                                        <text>border-top-danger border-top-3 mb-3</text>
            }
        }">
                    <div class="card-body">
                        <h5 class="card-title">Điểm số @totalScore/10 điểm</h5>
                        <p class="card-text"><small>Đánh giá: <b
                    @{
                        if (danhgia == "tốt")
                        {
                                                    <text>class="text-success</text>
                        }
                        if (danhgia == "trung bình")
                        {
                                                    <text>class="text-warning</text>
                        }
                        if (danhgia == "không đạt")
                        {
                                                    <text>class="text-danger</text>
                        }
                    }
                    ">@danhgia</b> </small></p>
                 <hr>
            <div style="position: relative; text-align: center;">
                <div style="width: 100%; position: absolute; top: 50%; left: 0; transform: translateY(-50%); z-index: 999999999999999">
                    @{
                        if (danhgia == "tốt")
                        {
                                            <h1 class="display-6 text-success animate__animated animate__rotateIn">OK</h1>
                        }
                        if (danhgia == "trung bình")
                        {
                                            <h1 class="display-6 text-warning animate__animated animate__rotateIn">OK</h1>
                        }
                        if (danhgia == "không đạt")
                        {
                                            <h1 class="display-6 text-danger animate__animated animate__rotateIn">NG</h1>
                        }
                    }
                </div>
                <canvas style="width:100%" id="myChart3"></canvas>
            </div>


            </div>
        </div>
            </div>
            <div class="col-md-12">
                <div class="card ">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4">
                                <div class="border-start border-start-4 border-start-info px-3 mb-3">
                                    <small class="text-medium-emphasis">Thời gian làm bài thi</small>
                                    <div class="fs-7">@Model.ThoiGianLamBai phút</div>
                                    <span class="badge bg-light me-2 text-dark"> Cho phép</span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="border-start border-start-4 border-start-info px-3 mb-3">
                                    <small class="text-medium-emphasis">Trắc nghiệm</small>
                                    <div class="fs-7">Đúng @slDungTN/@slCauhoiTN câu </div>
                                    <span class="badge bg-light me-2 text-dark"> @scoreTN/@totalScoreTN điểm</span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="border-start border-start-4 border-start-info px-3 mb-3">
                                    <small class="text-medium-emphasis">Tự luận</small>
                                    <div class="fs-7">Đúng @slDungTL/@slCauhoiTL câu</div>
                                    <span class="badge bg-light me-2 text-dark">@scoreTL/@totalScoreTL điểm</span>

                                </div>
                            </div>
                        </div>
                        <nav>
                            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                <button class="nav-link active" id="nav-home-tab" data-coreui-toggle="tab" data-coreui-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">
                                    <i class="bi-dot"></i>
                                    Phần thi trắc nghiệm
                                </button>
                                <button class="nav-link" id="nav-profile-tab" data-coreui-toggle="tab" data-coreui-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">
                                    <i class="bi-dot"></i>
                                    Phần thi tự luận
                                </button>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                                <div class="accordion">
                                    @foreach (var item in Model.LogExams.Where(x=>x.LoaiCauHoi=="TN"))
                                    {
                                    demtn++;
                                    string idThe = "tn" + item.Id.ToString();
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-coreui-toggle="collapse" data-coreui-target="#@idThe" aria-expanded="false" aria-controls="@idThe">
                                                @{
                                                if (item.Cautraloi.ToUpper() == item.Dapandung.ToUpper())
                                                {
                                                    <span class="badge bg-success me-2 ">
                                                        Câu @demtn
                                                        <small>
                                                            <span class="badge bg-dark" style="vertical-align: text-top;">
                                                                @item.Score điểm
                                                            </span>
                                                        </small>
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-danger me-2 ">
                                                        Câu @demtn
                                                        <small>
                                                            <span class="badge bg-dark" style="vertical-align: text-top;">
                                                                @item.Score điểm
                                                            </span>
                                                        </small>
                                                    </span>
                                                }
                                                }
                                                @item.Cauhoi
                                            </button>
                                        </h2>
                                        <div id="@idThe" class="accordion-collapse collapse" data-coreui-parent="#accordionExample">
                                            <div class="accordion-body">
                                                <div class="row">
                                                    @{
                                                    if (!string.IsNullOrEmpty(item.QA))
                                                    {
                                                    if (item.Dapandung == "A")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-success mb-2" disabled>@item.QA</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                    if (item.Cautraloi == "A")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-danger " disabled>@item.QA</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-outline-light " disabled>@item.QA</button>
                                                        </div>
                                                    }

                                                    }

                                                    }
                                                    if (!string.IsNullOrEmpty(item.QB))
                                                    {
                                                    if (item.Dapandung == "B")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-success " disabled>@item.QB</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                    if (item.Cautraloi == "B")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-danger " disabled>@item.QB</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-outline-light " disabled>@item.QB</button>
                                                        </div>
                                                    }
                                                    }
                                                    }
                                                    if (!string.IsNullOrEmpty(item.QC))
                                                    {
                                                    if (item.Dapandung == "C")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-success " disabled>@item.QC</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                    if (item.Cautraloi == "C")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-danger " disabled>@item.QC</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-outline-light " disabled>@item.QC</button>
                                                        </div>
                                                    }
                                                    }
                                                    }
                                                    if (!string.IsNullOrEmpty(item.QD))
                                                    {
                                                    if (item.Dapandung == "D")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-success " disabled>@item.QD</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                    if (item.Cautraloi == "D")
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-danger " disabled>@item.QD</button>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-6">
                                                            <button class="btn w-100 text-black btn-outline-light " disabled>@item.QD</button>
                                                        </div>
                                                    }
                                                    }
                                                    }
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                                <div class="accordion">
                                    @{
                                    foreach (var item in Model.LogExams.Where(x=>x.LoaiCauHoi=="TL") )
                                    {
                                    demtl++;
                                    string idThe = "tl" + item.Id.ToString();
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-coreui-toggle="collapse" data-coreui-target="#@idThe" aria-expanded="false" aria-controls="@idThe">
                                                    @{
                                                if (item.Score == item.FinalScore)
                                                {
                                                        <span class="badge bg-success me-2 ">
                                                            Câu @demtl
                                                            <small>
                                                                <span class="badge bg-dark" style="vertical-align: text-top;">
                                                                    @item.Score điểm
                                                                </span>
                                                            </small>
                                                        </span>
                                                }
                                                else
                                                {
                                                        <span class="badge bg-danger me-2 ">
                                                            Câu @demtl
                                                            <small>
                                                                <span class="badge bg-dark" style="vertical-align: text-top;">
                                                                    @item.Score điểm
                                                                </span>
                                                            </small>
                                                        </span>
                                                }
                                                    }
                                                    @item.Cauhoi
                                                </button>
                                            </h2>
                                            <div id="@idThe" class="accordion-collapse collapse" data-coreui-parent="#accordionExample">
                                                <div class="accordion-body">
                                                    <p class="mb-1" style="text-align:start;font-weight:600;"> I. Sắp xếp theo đúng trình tự WSD:</p>
                                                    <table class="table table-bordered table-hover " style="width:100%">
                                                        <thead style="vertical-align:middle;font-size:small">
                                                            <tr>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Trả lời
                                                                </th>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Đáp án đúng
                                                                </th>
                                                                <th class="col-8" style="text-align:start;font-weight: 300">
                                                                    Nội dung thao tác
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        @foreach (var itemNoiDung in item.LogExamTrinhtuthaotacs as List<ViewModels.LogExamTrinhtuthaotac.Response.LogExamTrinhtuthaotacVm>)
                                                        {
                                                            if (itemNoiDung.ThuTu == itemNoiDung.Answer)
                                                            {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-success p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @itemNoiDung.Answer
                                                                    </td>
                                                                    <td>
                                                                        @itemNoiDung.ThuTu
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @itemNoiDung.Text
                                                                    </td>
                                                               
                                                                </tr>
                                                            }
                                                            else
                                                            {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-danger p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @itemNoiDung.Answer
                                                                    </td>
                                                                    <td>
                                                                        @itemNoiDung.ThuTu
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @itemNoiDung.Text
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }
                                                        </tbody>
                                                    </table>


                                                    <p class="mb-1" style="text-align:start;font-weight:600;"> II. Điểm chú ý tại công đoạn / Spec tại công đoạn (Nếu có):</p>
                                                    <table class="table table-bordered table-hover " style="width:100%">
                                                        <thead style="vertical-align:middle;font-size:small">
                                                            <tr>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Trả lời
                                                                </th>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Đáp án đúng
                                                                </th>
                                                                <th class="col-8" style="font-weight: 300;text-align:start">
                                                                    Điểm chú ý
                                                                </th>

                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @{
                                                         foreach (var i in item.logExamDiemChuYs as List<ViewModels.LogExamDiemChuY.Response.LogExamDiemChuYVm>)
                                                        {
                                                        if (i.Answer == i.CorrectAnswer)
                                                        {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-success p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>

                                                                </tr>
                                                        }
                                                        else
                                                        {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-danger p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>

                                                                </tr>
                                                        }

                                                        }

                                                            }
                                                        </tbody>
                                                    </table>


                                                    <p class="mb-1" style="text-align:start;font-weight:600;"> III. Lỗi tại công đoạn:</p>
                                                    <table class="table table-bordered table-hover " style="width:100%">
                                                        <thead style="vertical-align:middle;font-size:small">
                                                            <tr>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Trả lời
                                                                </th>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Đáp án đúng
                                                                </th>
                                                                <th class="col-8" style="font-weight: 300;text-align:start">
                                                                    Lỗi tại công đoạn
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        @{
                                                        foreach (var i in item.logExamLoiTaiCongDoans as List<ViewModels.LogExamLoiTaiCongDoan.Response.LogExamLoiTaiCongDoanVm>)
                                                        {
                                                            if (i.Answer == i.CorrectAnswer)
                                                            {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-success p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>
                                                                </tr>
                                                            }
                                                            else
                                                            {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-danger p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }
                                                        }
                                                        </tbody>
                                                    </table>

                                                    <p class="mb-1" style="text-align:start;font-weight:600;"> IV. Đối sách:</p>
                                                    <table class="table table-bordered table-hover " style="width:100%">
                                                        <thead style="vertical-align:middle;font-size:small">
                                                            <tr>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Trả lời
                                                                </th>
                                                                <th class="col-2" style="text-align:center;font-weight: 300">
                                                                    Đáp án đúng
                                                                </th>
                                                                <th class="col-8" style="font-weight: 300;text-align:start">
                                                                    Đối sách
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @{
                                                        foreach (var i in item.logExamDoiSaches as List<ViewModels.LogExamDoiSach.Response.LogExamDoiSachVm>)
                                                        {
                                                        if (i.Answer == i.CorrectAnswer)
                                                        {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-success p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>

                                                                </tr>
                                                        }
                                                        else
                                                        {
                                                                <tr style="text-align:center;vertical-align:middle" class="bg-danger p-2 text-dark bg-opacity-10">
                                                                    <td>
                                                                        @i.Answer
                                                                    </td>
                                                                    <td>
                                                                        @i.CorrectAnswer 
                                                                    </td>
                                                                    <td style="text-align:start">
                                                                        @i.Text
                                                                    </td>

                                                                </tr>
                                                        }
                                                        }
                                                            }
                                                        </tbody>
                                                    </table>




                                                </div>
                                            </div>
                                        </div>
                                    }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>  
</div>


<script>
    $(document).ready(function () {
        Chart.register(ChartDataLabels); // Enable plugin
        const ctx = document.getElementById('myChart3').getContext('2d');
        var tracnghiemScore = @scoreTN;
        var tuluanScore = @scoreTL;
        var totalScore = tracnghiemScore + tuluanScore;
        var errorScore = 10 - totalScore;
        // Create a pie chart
        var myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Trắc nghiệm', 'Tự luận', 'Sai'],
                datasets: [{
                    data: [tracnghiemScore, tuluanScore, errorScore],
                    backgroundColor: [
                        'rgba(46, 184, 92, 0.5)',
                        'rgba(46, 184, 92, 0.5)',
                        'rgba(229, 83, 83, 0.5)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: false,
                        text: 'Biểu đồ kết quả điểm số bài thi'
                    },
                    datalabels: {
                        formatter: (value, ctx) => {
                            return ctx.chart.data.labels[ctx.dataIndex] + ': ' + value + ' điểm';
                        },
                        color: 'black',
                        backgroundColor: 'hsla(70 100% 50% / 0.7)',
                        font: {
                            size: 12,
                        },
                        display: true,
                    },
                },
                tooltips: {
                    enabled: true,
                },

            }
        });
    })

</script>

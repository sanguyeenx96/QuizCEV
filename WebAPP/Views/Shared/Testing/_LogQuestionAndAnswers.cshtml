@model List<ViewModels.Question.Response.QuestionAndAnswerVm>


@{
    //List<ViewModels.Question.Response.QuestionAndAnswerVm> cauhoivacautraloitracnghiem = ViewBag.questionAndAnswerTracNghiem as List<ViewModels.Question.Response.QuestionAndAnswerVm>;
    int demtn = 0;
    int demtl = 0;

}

<h1 class="display-6 mb-3">
    <i class="bi-chevron-down"></i>
    Phần thi trắc nghiệm
</h1>

@foreach (var item in Model)
{
    demtn++;
    string idThe = item.Id.ToString();
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-coreui-toggle="collapse" data-coreui-target="#@idThe" aria-expanded="false" aria-controls="@idThe">
                <span style="opacity:0.8" class="badge bg-dark me-2 ">Câu @demtn</span>  @item.Text
            </button>
        </h2>
        <div id="@idThe" class="accordion-collapse collapse" data-coreui-parent="#accordionExample">
            <div class="accordion-body">
                <div class="row">
                    @{
                        if (!string.IsNullOrEmpty(item.QA))
                        {
                            <div class="col-6">
                                <button class="btn w-100 btnDoicautraloi
                                @if(item.Answer == "A")
                            {
                                        <text>btn-warning disabled</text>
                                            }
                                            else
                                            {
                                        <text>btn-outline-primary</text>
                                            }
                                    mt-1" data-id="@item.Id" data-newAs="A">@item.QA</button>
                            </div>
                        }
                        if (!string.IsNullOrEmpty(item.QB))
                        {
                            <div class="col-6">
                                <button class="btn w-100 btnDoicautraloi
                                @if(item.Answer == "B")
                            {
                                            <text>btn-warning disabled</text>
                                            }
                                            else
                                            {
                                        <text>btn-outline-primary</text>
                                            }
                                    mt-1" data-id="@item.Id" data-newAs="B">@item.QB</button>
                            </div>
                        }
                        if (!string.IsNullOrEmpty(item.QC))
                        {
                            <div class="col-6">
                                <button class="btn w-100 btnDoicautraloi
                                @if(item.Answer == "C")
                            {
                                                <text>btn-warning disabled</text>
                                            }
                                            else
                                            {
                                        <text>btn-outline-primary</text>
                                            }
                                    mt-1" data-id="@item.Id" data-newAs="C">@item.QC</button>
                            </div>
                        }
                        if (!string.IsNullOrEmpty(item.QD))
                        {
                            <div class="col-6">
                                <button class="btn w-100 btnDoicautraloi
                                @if(item.Answer == "D")
                            {
                                            <text>btn-warning disabled</text>
                                            }
                                            else
                                            {
                                        <text>btn-outline-primary</text>
                                            }
                                    mt-1" data-id="@item.Id" data-newAs="D">@item.QD</button>
                            </div>
                        }
                    }
                </div>
            </div>

        </div>
    </div>
}

<h1 class="display-6 my-3">
    <i class="bi-chevron-down"></i>
    Phần tự luận
</h1>
@{
    if (ViewBag.listQuestionAndAnswerTrinhTuThaoTac != null)
    {
        List<ViewModels.CauHoiTrinhTuThaoTac.Response.QuestionAndAnswerTrinhTuThaoTacVm> lichsuTuluan = ViewBag.listQuestionAndAnswerTrinhTuThaoTac as List<ViewModels.CauHoiTrinhTuThaoTac.Response.QuestionAndAnswerTrinhTuThaoTacVm>;
        var groupDataTuluan = lichsuTuluan.GroupBy(x => x.CauHoiTuLuanId);
        foreach (var group in groupDataTuluan)
        {
            demtl++;
            string idThe = group.FirstOrDefault().Id.ToString();
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-coreui-toggle="collapse" data-coreui-target="#@idThe" aria-expanded="false" aria-controls="@idThe">
                        <span style="opacity:0.8" class="badge bg-dark me-2 ">Câu @demtl</span>  @group.FirstOrDefault().CauHoiTuLuanText
                    </button>
                </h2>
                <div id="@idThe" class="accordion-collapse collapse" data-coreui-parent="#accordionExample">
                    <div class="accordion-body">
                        <div class="card">
                            <div class="card-body">
                                <table id="trinhtuthaotac" class="table table-hover " style="width:100%">
                                    <thead style="vertical-align:middle;font-size:small">
                                        <tr>
                                            <th class="col-2" style="text-align:center;font-weight: 300">
                                                Thứ tự
                                            </th>
                                            <th hidden>
                                                Id
                                            </th>
                                            <th class="col-8" style="font-weight: 300">
                                                Nội dung thao tác
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in group.OrderBy(x => x.Answer))
                                        {
                                            <tr style="text-align:center;vertical-align:middle">
                                                <td>
                                                    @item.Answer
                                                </td>
                                                <td hidden>
                                                    @item.Id
                                                </td>
                                                <td style="text-align:start">
                                                    @item.Text
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
}


<script>
    $(document).ready(function () {
        $(".btnDoicautraloi").click(function () {
            var id = $(this).attr("data-id");
            var intId = parseInt(id);
            var newas = $(this).attr("data-newAs");
            $.ajax({
                url: 'ChangeAnswer',
                type: 'POST',
                data: { id: intId, newAns: newas },
                success: function (response) {
                    Swal.fire({
                        icon: "success",
                        width: 300,
                        text: "Đổi câu trả lời thành công",
                        showConfirmButton: false,
                        timer: 1000,

                    })
                    $.ajax({
                        url: 'GetLogQuestionAndAnswers',
                        type: 'GET',
                        success: function (response) {
                            $("#accordionExample").html(response);
                        },
                        error: function (error) {
                            console.log(error);
                        }
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            });
        })
    })
</script>